<html>
  <body>
    <button onclick="refresh()">Refresh</button>
    <button onclick="stop()">Stop</button>

    <img id="live" />
    <img id="source" />
    <script>
      let isRunning = false
      async function start() {
        const response = await fetch('api/start?width=500&height=500', {
          method: 'GET',
        })
        window.requestAnimationFrame(() => updateImage('api/render', 'live'))

        updateImage('api/source', 'source')
        // isRunning = true
      }

      async function stop() {
        await fetch('/api/stop')
        isRunning = false
        console.log('Stopped')
      }

      async function updateImage(url, id) {
        const response = await fetch(url)
        const pixels = await response.text()
        if (pixels) {
          const liveImg = document.getElementById(id)
          liveImg.src = pixels
        }
        if (isRunning) window.requestAnimationFrame(updateImage)
      }

      function refresh() {
        updateImage('api/render', 'live')
      }
      start()
    </script>
  </body>
</html>
